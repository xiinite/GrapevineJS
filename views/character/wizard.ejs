<% layout("../layout.ejs") %>
<script type="text/javascript" src="/js/controllers/characterwizardController.js"></script>
<div class="container" ng-controller="CharacterWizardController" ng-init="init('<%= characterid %>')">
    <div class='col-xs-12 col-lg-12 col-sm-12'>
        <div>
            <script id="wizard.html" type="text/ng-template">
                <div class="wizard">
                    <div ng-transclude></div>

                    <div class="row">
                        <div class="row voffset1 text-center">
                            <a class="btn btn-default" ng-click="showPreviousStep()"
                               ng-show="hasPrevious()">Previous</a>
                            <a class="btn btn-primary" ng-click="showNextStep()" ng-show="hasNext()">Next</a>
                        </div>
                    </div>
                </div>
            </script>

            <h3> Create draft:</h3>

            <div class="col-lg-6 col-sm-12">
                <wizard on-before-step-change="log(event)" on-step-changing="log(event)"
                        on-after-step-change="log(event)">

                    <step title="Step 1: Inspiration - Who are you? (LotN: 63)">
                        <div class="row">
                            <div class="col-lg-12">
                                <ul class="list-group">
                                    <li class="list-group-item">
                                        Choose a name
                                    </li>
                                    <li class="list-group-item">
                                        Choose a nature and demeanor (LotN: 73)
                                    </li>
                                    <li class="list-group-item">
                                        Choose a Morality Path (LotN: 74)
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <form class="form-horizontal" name="stepform" ng-init="setFormScope(this)">
                            <div class="form-group"
                                 ng-class="{'has-error': !character.name, 'has-feedback': !character.name}">
                                <label class="control-label col-lg-3"><b>Name: </b></label>

                                <div class="col-lg-7">
                                    <input type="text" class="form-control" ng-class="{'has-error': !character.name}"
                                           ng-model="character.name"
                                           ng-required="true"/>
                                <span ng-show="!character.name" class="glyphicon glyphicon-remove form-control-feedback"
                                      aria-hidden="true"></span>
                                    <span ng-show="!character.name" class="sr-only">(error)</span>
                                </div>
                            </div>
                            <div class="form-group"
                                 ng-class="{'has-error': !character.nature, 'has-feedback': !character.nature}">

                                <label class="control-label col-lg-3"><b>Nature:</b></label>

                                <div class="col-lg-7">
                                    <select class="form-control"
                                            ng-required="true"
                                            ng-options="nature as nature for nature in natures"
                                            ng-model="character.nature">
                                        <option style="display:none" value="">Select a nature</option>
                                    </select>
                            <span ng-show="!character.nature" class="glyphicon glyphicon-remove form-control-feedback"
                                  aria-hidden="true"></span>
                                    <span ng-show="!character.nature" class="sr-only">(error)</span>
                                </div>
                            </div>
                            <div class="form-group"
                                 ng-class="{'has-error': !character.demeanor, 'has-feedback': !character.demeanor}">

                                <label class="control-label col-lg-3"><b>Demeanor:</b></label>

                                <div class="col-lg-7">
                                    <select class="form-control"
                                            ng-required="true"
                                            ng-options="nature as nature for nature in natures"
                                            ng-model="character.demeanor">
                                        <option style="display:none" value="">Select a nature</option>
                                    </select>
                            <span ng-show="!character.demeanor" class="glyphicon glyphicon-remove form-control-feedback"
                                  aria-hidden="true"></span>
                                    <span ng-show="!character.demeanor" class="sr-only">(error)</span>
                                </div>
                            </div>
                            <div class="form-group"
                                 ng-class="{'has-error': !character.path.name, 'has-feedback': !character.path.name}">

                                <label class="control-label col-lg-3"><b>Morality Path:</b></label>

                                <div class="col-lg-7">
                                    <select class="form-control"
                                            ng-required="true"
                                            ng-options="path.name as path.name for path in paths"
                                            ng-change="onselectedpath()"
                                            ng-model="character.path.name">
                                        <option style="display:none" value="">Select a path</option>
                                    </select>
                                    <span ng-show="!character.path.name"
                                          class="glyphicon glyphicon-remove form-control-feedback"
                                          aria-hidden="true"></span>
                                    <span ng-show="!character.path.name" class="sr-only">(error)</span>
                                </div>
                            </div>
                        </form>
                    </step>

                    <step title="Step 2: Attributes - What are your basic capabilities?  (LotN: 66)">
                        <div class="row">
                            <div class="col-lg-12">
                                <ul class="list-group">
                                    <li class="list-group-item">
                                        Prioritize Attributes (seven primary, five secondary and three tertiary)
                                    </li>
                                    <li class="list-group-item">
                                        Choose traits (LotN: 79)
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <form class="form-horizontal" name="stepform" ng-init="setFormScope(this)">
                            <!-- Primary attributes -->
                            <div class="form-group"
                                 ng-class="{'has-error': !primary, 'has-feedback': !primary}">
                                <label class="control-label col-lg-3"><b>Primary Attribute:</b></label>

                                <div class="col-lg-7">
                                    <select class="form-control"
                                            ng-required="true"
                                            ng-options="item as item.key for item in attributes"
                                            ng-change="clear(character.attributes[primary.key], [secondary, tertiary])"
                                            ng-model="primary">
                                        <option style="display:none" value="">Select an attribute group</option>
                                    </select>
                                    <span ng-show="!primary"
                                          class="glyphicon glyphicon-remove form-control-feedback"
                                          aria-hidden="true"></span>
                                    <span ng-show="!primary" class="sr-only">(error)</span>
                                </div>
                            </div>
                            <div class="form-group"
                                 ng-show="primary">
                                <div class="col-lg-12">

                                    <ul class="list-group">
                                        <li class="list-group-item active">{{
                                            calctotal(character.attributes[primary.key]) }} {{primary.key}}
                                            Traits
                                        </li>
                                        <li ng-repeat='t in character.attributes[primary.key] | orderBy:"name":false'
                                            class="list-group-item trait">
                                            {{ t.name }}
                                            <span ng-show="t.val > 1">
                                                ({{ t.val }})
                                            </span>
                                            <button ng-click="removeTrait(t.name, character.attributes[primary.key])"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-minus"></span></button>
                                            <button ng-hide="calctotal(character.attributes[primary.key]) > 6"
                                                    ng-click="addTrait(t.name, character.attributes[primary.key])"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-plus"></span>
                                            </button>
                                        </li>
                                    </ul>
                                    <div class="col-lg-12"
                                         ng-hide="calctotal(character.attributes[primary.key]) > 6">
                                        <div class="col-lg-9">
                                            <select id="slc-physical" class="form-control"
                                                    ng-options="attr for attr in primary.val"
                                                    ng-model="sprimary">
                                                <option style="display:none" value="">Select a trait</option>
                                            </select>
                                        </div>
                                        <button ng-click="addTrait(sprimary, character.attributes[primary.key])"
                                                class="btn btn-default btn-sm pull-right col-lg-3">Add
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <!-- Secondary attributes -->
                            <hr ng-show="showSecondaryList"/>
                            <div class="form-group"
                                 ng-show="showSecondaryList"
                                 ng-class="{'has-error': !secondary, 'has-feedback': !secondary}">
                                <label class="control-label col-lg-3"><b>Secondary Attribute:</b></label>

                                <div class="col-lg-7">
                                    <select class="form-control"
                                            ng-required="true"
                                            ng-options="item as item.key for item in attributes |exclude: [primary]"
                                            ng-change="clear(character.attributes[secondary.key], [tertiary])"
                                            ng-model="secondary">
                                        <option style="display:none" value="">Select an attribute group</option>
                                    </select>
                                    <span ng-show="!secondary"
                                          class="glyphicon glyphicon-remove form-control-feedback"
                                          aria-hidden="true"></span>
                                    <span ng-show="!secondary" class="sr-only">(error)</span>
                                </div>
                            </div>
                            <div class="form-group"
                                 ng-show="showSecondary">
                                <div class="col-lg-12">

                                    <ul class="list-group">
                                        <li class="list-group-item active">{{
                                            calctotal(character.attributes[secondary.key])
                                            }} {{secondary.key}}
                                            Traits
                                        </li>
                                        <li ng-repeat='t in character.attributes[secondary.key] | orderBy:"name":false'
                                            class="list-group-item trait">
                                            {{ t.name }}
                                            <span ng-show="t.val > 1">
                                                ({{ t.val }})
                                            </span>
                                            <button ng-click="removeTrait(t.name, character.attributes[secondary.key])"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-minus"></span></button>
                                            <button ng-hide="calctotal(character.attributes[secondary.key]) > 4"
                                                    ng-click="addTrait(t.name, character.attributes[secondary.key])"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-plus"></span>
                                            </button>
                                        </li>
                                    </ul>
                                    <div class="col-lg-12"
                                         ng-hide="calctotal(character.attributes[secondary.key]) > 4">
                                        <div class="col-lg-9">
                                            <select id="slc-physical" class="form-control"
                                                    ng-options="attr for attr in secondary.val"
                                                    ng-model="ssecondary">
                                                <option style="display:none" value="">Select a trait</option>
                                            </select>
                                        </div>
                                        <button ng-click="addTrait(ssecondary, character.attributes[secondary.key])"
                                                class="btn btn-default btn-sm pull-right col-lg-3">Add
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <!-- Tertiary attributes -->
                            <hr ng-show="showTertiaryList"/>
                            <div class="form-group"
                                 ng-show="showTertiaryList"
                                 ng-class="{'has-error': !primary, 'has-feedback': !tertiary}">
                                <label class="control-label col-lg-3"><b>Tertiary Attributes:</b></label>

                                <div class="col-lg-7">
                                    <select class="form-control"
                                            ng-required="true"
                                            ng-options="item as item.key for item in attributes |exclude: [primary, secondary]"
                                            ng-change="clear(character.attributes[tertiary.key], [])"
                                            ng-model="tertiary">
                                        <option style="display:none" value="">Select an attribute group</option>
                                    </select>
                                    <span ng-show="!tertiary"
                                          class="glyphicon glyphicon-remove form-control-feedback"
                                          aria-hidden="true"></span>
                                    <span ng-show="!tertiary" class="sr-only">(error)</span>
                                </div>
                            </div>
                            <div class="form-group"
                                 ng-show="showTertiary">
                                <div class="col-lg-12">

                                    <ul class="list-group">
                                        <li class="list-group-item active">{{
                                            calctotal(character.attributes[tertiary.key])
                                            }} {{tertiary.key}}
                                            Traits
                                        </li>
                                        <li ng-repeat='t in character.attributes[tertiary.key] | orderBy:"name":false'
                                            class="list-group-item trait">
                                            {{ t.name }}
                                            <span ng-show="t.val > 1">
                                                ({{ t.val }})
                                            </span>
                                            <button ng-click="removeTrait(t.name, character.attributes[tertiary.key])"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-minus"></span></button>
                                            <button ng-hide="calctotal(character.attributes[tertiary.key]) > 2"
                                                    ng-click="addTrait(t.name, character.attributes[tertiary.key])"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-plus"></span>
                                            </button>
                                        </li>
                                    </ul>
                                    <div class="col-lg-12"
                                         ng-hide="calctotal(character.attributes[tertiary.key]) > 2">
                                        <div class="col-lg-9">
                                            <select class="form-control"
                                                    ng-options="attr for attr in tertiary.val"
                                                    ng-model="stertiary">
                                                <option style="display:none" value="">Select a trait</option>
                                            </select>
                                        </div>
                                        <button ng-click="addTrait(stertiary, character.attributes[tertiary.key])"
                                                class="btn btn-default btn-sm pull-right col-lg-3">Add
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </step>

                    <step title="Step 3: Advantages - What do you know? (LotN: 67">
                        <div class="row">
                            <div class="col-lg-12">
                                <ul class="list-group">
                                    <li class="list-group-item">
                                        Choose five abilities (LotN: 85)
                                    </li>
                                    <li class="list-group-item">
                                        Choose three Basic Disciplines (LotN: 132)
                                    </li>
                                    <li class="list-group-item">
                                        Choose any combination of five Backgrounds and Influences (LotN: 93)
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <form class="form-horizontal" name="stepform" ng-init="setFormScope(this)">
                            <!-- Abilities -->
                            <div class="form-group">
                                <div class="col-lg-12">
                                    <ul class="list-group">
                                        <li class="list-group-item active">{{
                                            calctotal(character.abilities) }} Ability
                                            Traits
                                        </li>
                                        <li ng-repeat='t in character.abilities | orderBy:"name":false'
                                            class="list-group-item trait">
                                            {{ t.name }}
                                            <span ng-show="t.val > 1">
                                                x{{ t.val }}
                                            </span>
                                            <span ng-show="t.note.length > 0">
                                                ({{ t.note }})
                                            </span>
                                            <button ng-click="removeAdvantage(t.name, character.abilities)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-minus"></span></button>
                                            <button ng-hide="calctotal(character.abilities) > 4"
                                                    ng-click="addAdvantage(t.name, character.abilities)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-plus"></span>
                                            </button>
                                            <button ng-click="addNoteDialog(t, character.abilities)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-pencil"></span></button>
                                        </li>
                                    </ul>

                                    <div class="col-lg-12"
                                         ng-hide="calctotal(character.abilities) > 4">
                                        <div class="col-lg-9">
                                            <select id="slc-physical" class="form-control"
                                                    ng-options="attr for attr in abilities"
                                                    ng-model="sability">
                                                <option style="display:none" value="">Select an ability</option>
                                            </select>
                                        </div>
                                        <button ng-click="addAdvantage(sability, character.abilities)"
                                                class="btn btn-default btn-sm pull-right col-lg-3">Add
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Disciplines -->
                            <div class="form-group">
                                <div class="col-lg-12">
                                    <ul class="list-group">
                                        <li class="list-group-item active">{{
                                            character.disciplines.length }} Disciplines
                                        </li>
                                        <li ng-repeat='t in character.disciplines | orderBy:"path":false'
                                            class="list-group-item trait">
                                            {{ t.path }}: {{t.name}} ({{t.level}})
                                            <button ng-click="removeDiscipline(t, character.disciplines)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-minus"></span></button>
                                        </li>
                                    </ul>

                                    <div class="col-lg-12"
                                         ng-hide="character.disciplines.length > 2">
                                        <div class="col-lg-9">
                                            <select id="slc-physical" class="form-control"
                                                    ng-options="attr as attr.path + ': ' + attr.name for attr in disciplines | isClanDiscipline: [character.clan, clandisciplines]"
                                                    ng-model="sdisciplines">
                                                <option style="display:none" value="">Select a Discipline</option>
                                            </select>
                                        </div>
                                        <button ng-click="addDiscipline(sdisciplines, character.disciplines)"
                                                class="btn btn-default btn-sm pull-right col-lg-3">Add
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Backgrounds -->
                            <div class="form-group">
                                <div class="col-lg-12">
                                    <ul class="list-group">
                                        <li class="list-group-item active">{{
                                            calctotal(character.backgrounds) }} Background
                                            Traits
                                        </li>
                                        <li ng-repeat='t in character.backgrounds | orderBy:"name":false'
                                            class="list-group-item trait">
                                            {{ t.name }}
                                            <span ng-show="t.val > 1">
                                                x{{ t.val }}
                                            </span>
                                            <span ng-show="t.note.length > 0">
                                                ({{ t.note }})
                                            </span>
                                            <button ng-click="removeAdvantage(t.name, character.backgrounds)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-minus"></span></button>
                                            <button ng-hide="calctotal(character.backgrounds) + calctotal(character.influences) > 4"
                                                    ng-click="addAdvantage(t.name, character.backgrounds)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-plus"></span>
                                            </button>
                                            <button ng-click="addNoteDialog(t, character.backgrounds)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-pencil"></span></button>
                                        </li>
                                    </ul>

                                    <div class="col-lg-12"
                                         ng-hide="calctotal(character.backgrounds) + calctotal(character.influences) > 4">
                                        <div class="col-lg-9">
                                            <select id="slc-physical" class="form-control"
                                                    ng-options="attr for attr in backgrounds"
                                                    ng-model="sbackground">
                                                <option style="display:none" value="">Select a background</option>
                                            </select>
                                        </div>
                                        <button ng-click="addAdvantage(sbackground, character.backgrounds)"
                                                class="btn btn-default btn-sm pull-right col-lg-3">Add
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Influences -->
                            <div class="form-group">
                                <div class="col-lg-12">
                                    <ul class="list-group">
                                        <li class="list-group-item active">{{
                                            calctotal(character.influences) }} Influence
                                            Traits
                                        </li>
                                        <li ng-repeat='t in character.influences | orderBy:"name":false'
                                            class="list-group-item trait">
                                            {{ t.name }}
                                            <span ng-show="t.val > 1">
                                                x{{ t.val }}
                                            </span>
                                            <span ng-show="t.note.length > 0">
                                                ({{ t.note }})
                                            </span>
                                            <button ng-click="removeAdvantage(t.name, character.influences)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-minus"></span></button>
                                            <button ng-hide="calctotal(character.backgrounds) + calctotal(character.influences) > 4"
                                                    ng-click="addAdvantage(t.name, character.influences)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-plus"></span>
                                            </button>
                                            <button ng-click="addNoteDialog(t, character.influences)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-pencil"></span></button>
                                        </li>
                                    </ul>

                                    <div class="col-lg-12"
                                         ng-hide="calctotal(character.backgrounds) + calctotal(character.influences) > 4">
                                        <div class="col-lg-9">
                                            <select id="slc-physical" class="form-control"
                                                    ng-options="attr for attr in influences"
                                                    ng-model="sinfluence">
                                                <option style="display:none" value="">Select an influence</option>
                                            </select>
                                        </div>
                                        <button ng-click="addAdvantage(sinfluence, character.influences)"
                                                class="btn btn-default btn-sm pull-right col-lg-3">Add
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </step>

                    <step title="Step 4: Last touches - Fill in the details (LotN: 68)">
                        <div class="row">
                            <div class="col-lg-12">
                                <ul class="list-group">
                                    <li class="list-group-item">
                                        Assign Virtue traits (LotN: 108)
                                    </li>
                                    <li class="list-group-item">
                                        <label class="label-warning">Optional: </label> Negative Traits (max 5 traits) and Flaws (max 7 traits) (if any) (LotN: 112)
                                    </li>
                                    <li class="list-group-item">
                                        <label class="label-warning">Optional: </label> Choose a Derangement (if desired, <u>this is not the Derangement for Clan Malkavian's disadvantage</u>) (LotN: 112, 212)
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <form class="form-horizontal" name="stepform" ng-init="setFormScope(this)">

                            <!-- Virtues -->
                            <div class="form-group">
                                <div class="col-lg-12">
                                    <ul class="list-group">
                                        <li class="list-group-item active">{{
                                            character.conscience.rating + character.selfcontrol.rating + character.courage.rating }} Virtue
                                            Traits
                                        </li>
                                        <li class="list-group-item trait">
                                            {{ character.conscience.name }}: <span>x{{ character.conscience.rating }}</span>
                                            <button ng-click="removeVirtue(character.conscience)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-minus"></span></button>
                                            <button ng-show="showAddVirtue()"
                                                    ng-click="addVirtue(character.conscience)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-plus"></span>
                                            </button>
                                        </li>
                                        <li class="list-group-item trait">
                                            {{ character.selfcontrol.name }}: <span>x{{ character.selfcontrol.rating }}</span>
                                            <button ng-click="removeVirtue(character.selfcontrol)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-minus"></span></button>
                                            <button ng-show="showAddVirtue()"
                                                    ng-click="addVirtue(character.selfcontrol)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-plus"></span>
                                            </button>
                                        </li>
                                        <li class="list-group-item trait">
                                            {{ character.courage.name }}: <span>x{{ character.courage.rating }}</span>
                                            <button ng-click="removeVirtue(character.courage)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-minus"></span></button>
                                            <button ng-show="showAddVirtue()"
                                                    ng-click="addVirtue(character.courage)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-plus"></span>
                                            </button>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <!-- Negative physical -->
                            <div class="form-group">
                                <div class="col-lg-12">

                                    <ul class="list-group">
                                        <li class="list-group-item active">{{
                                            calctotal(character.attributes.negativephysical) }} Negative Physical Traits
                                        </li>
                                        <li ng-repeat='t in character.attributes.negativephysical | orderBy:"name":false'
                                            class="list-group-item trait">
                                            {{ t.name }}
                                            <span ng-show="t.val > 1">
                                                ({{ t.val }})
                                            </span>
                                            <button ng-click="removeTrait(t.name, character.attributes.negativephysical)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-minus"></span></button>
                                            <button ng-show="showNegativeTraits()"
                                                    ng-click="addTrait(t.name, character.attributes.negativephysical)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-plus"></span>
                                            </button>
                                        </li>
                                    </ul>
                                    <div class="col-lg-12"
                                         ng-show="showNegativeTraits()">
                                        <div class="col-lg-9">
                                            <select class="form-control"
                                                    ng-options="attr for attr in negativephysical"
                                                    ng-model="snegativephysical">
                                                <option style="display:none" value="">Select a trait</option>
                                            </select>
                                        </div>
                                        <button ng-click="addTrait(snegativephysical, character.attributes.negativephysical)"
                                                class="btn btn-default btn-sm pull-right col-lg-3">Add
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Negative Social -->
                            <div class="form-group">
                                <div class="col-lg-12">

                                    <ul class="list-group">
                                        <li class="list-group-item active">{{
                                            calctotal(character.attributes.negativesocial) }} Negative Social Traits
                                        </li>
                                        <li ng-repeat='t in character.attributes.negativesocial | orderBy:"name":false'
                                            class="list-group-item trait">
                                            {{ t.name }}
                                            <span ng-show="t.val > 1">
                                                ({{ t.val }})
                                            </span>
                                            <button ng-click="removeTrait(t.name, character.attributes.negativesocial)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-minus"></span></button>
                                            <button ng-show="showNegativeTraits()"
                                                    ng-click="addTrait(t.name, character.attributes.negativesocial)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-plus"></span>
                                            </button>
                                        </li>
                                    </ul>
                                    <div class="col-lg-12"
                                         ng-show="showNegativeTraits()">
                                        <div class="col-lg-9">
                                            <select class="form-control"
                                                    ng-options="attr for attr in negativesocial"
                                                    ng-model="snegativesocial">
                                                <option style="display:none" value="">Select a trait</option>
                                            </select>
                                        </div>
                                        <button ng-click="addTrait(snegativesocial, character.attributes.negativesocial)"
                                                class="btn btn-default btn-sm pull-right col-lg-3">Add
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Negative mental -->
                            <div class="form-group">
                                <div class="col-lg-12">

                                    <ul class="list-group">
                                        <li class="list-group-item active">{{
                                            calctotal(character.attributes.negativemental) }} Negative Mental Traits
                                        </li>
                                        <li ng-repeat='t in character.attributes.negativemental | orderBy:"name":false'
                                            class="list-group-item trait">
                                            {{ t.name }}
                                            <span ng-show="t.val > 1">
                                                ({{ t.val }})
                                            </span>
                                            <button ng-click="removeTrait(t.name, character.attributes.negativemental)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-minus"></span></button>
                                            <button ng-show="showNegativeTraits()"
                                                    ng-click="addTrait(t.name, character.attributes.negativemental)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-plus"></span>
                                            </button>
                                        </li>
                                    </ul>
                                    <div class="col-lg-12"
                                         ng-show="showNegativeTraits()">
                                        <div class="col-lg-9">
                                            <select class="form-control"
                                                    ng-options="attr for attr in negativemental"
                                                    ng-model="snegativemental">
                                                <option style="display:none" value="">Select a trait</option>
                                            </select>
                                        </div>
                                        <button ng-click="addTrait(snegativemental, character.attributes.negativemental)"
                                                class="btn btn-default btn-sm pull-right col-lg-3">Add
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Flaws -->
                            <div class="form-group">
                                <div class="col-lg-12">
                                    <ul class="list-group">
                                        <li class="list-group-item active">{{
                                            calctotalcost(character.flaws) }} Flaws
                                        </li>
                                        <li ng-repeat='t in character.flaws | orderBy:"name":false'
                                            class="list-group-item trait">
                                            {{ t.name }} ({{t.cost}})
                                            <button ng-click="removeFlaw(t, character.flaws)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-minus"></span></button>
                                            </button>
                                        </li>
                                    </ul>
                                    <div class="col-lg-12"
                                         ng-show="showFlaws()">
                                        <div class="col-lg-9">
                                            <select class="form-control"
                                                    ng-options="attr as attr.name +'('+ attr.cost + ')' for attr in flaws"
                                                    ng-model="sflaw">
                                                <option style="display:none" value="">Select a flaw</option>
                                            </select>
                                        </div>
                                        <button ng-click="addFlaw(sflaw, character.flaws)"
                                                class="btn btn-default btn-sm pull-right col-lg-3">Add
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Derangement -->
                            <div class="form-group">
                                <div class="col-lg-12">
                                    <ul class="list-group">
                                        <li class="list-group-item active">{{
                                            calctotal(character.derangements) }} Derangements
                                        </li>
                                        <li ng-repeat='t in character.derangements'
                                            class="list-group-item trait">
                                            {{t.name}}
                                            <button ng-click="removeDerangement(t.name, character.derangements)"
                                                    class="btn btn-xs pull-right"><span
                                                        class="glyphicon glyphicon-minus"></span></button>
                                            </button>
                                        </li>
                                    </ul>
                                    <div class="col-lg-12"
                                         ng-show="character.derangements.length == 0">
                                        <div class="col-lg-9">
                                            <select class="form-control"
                                                    ng-options="attr for attr in derangements"
                                                    ng-model="sderangement">
                                                <option style="display:none" value="">Select a Derangement</option>
                                            </select>
                                        </div>
                                        <button ng-click="addDerangement(sderangement, character.derangements)"
                                                class="btn btn-default btn-sm pull-right col-lg-3">Add
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </step>

                    <step title="Almost done...">
                        <div class="row">
                            <div class="col-lg-12">
                                <label class="label">Review your character to the left. In the next step, the
                                    following actions are performed:</label>

                                <ul class="list-group">
                                    <li class="list-group-item">
                                        (Automatic) Assign Clan advantages
                                    </li>
                                    <li class="list-group-item">
                                        (Automatic) Assign Chronicle advantages
                                    </li>
                                    <li class="list-group-item">
                                        (Automatic) Assign Blood traits (LotN : 95, 106)
                                    </li>
                                    <li class="list-group-item">
                                        (Automatic) Assign Willpower traits (LotN: 95, 107)
                                    </li>
                                    <li class="list-group-item">
                                        Spend five (or more) Free Traits and choose Merits (if any) (LotN: 71, 112, 212)
                                    </li>
                                    -
                                </ul>
                                <label class="label-warning">You will not be able to return after submitting this
                                    step</label>
                                <button class="btn btn-primary" ng-confirm-click="Are you sure?" ng-click="submitDraft()">Go to next step</button>
                            </div>
                        </div>
                    </step>

                </wizard>
            </div>

            <!-- Summary -->
            <div class="col-lg-6 hidden-sm hidden-xs">

                <!-- Concept -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        Concept
                    </div>
                    <div class="panel-body">
                        <div class="col-lg-6">
                            <div class="row">
                                <div class="col-lg-6"><b>Name: </b></div>
                                <div class="col-lg-6"><b>{{character.name}}</b></div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6"><b>Clan: </b></div>
                                <div class="col-lg-6"><b>{{character.clan}}</b></div>
                            </div>
                        </div>
                        <div class="col-lg-6" ng-show="currentIndex > 0">
                            <div class="row">
                                <div class="col-lg-6"><b>Nature: </b></div>
                                <div class="col-lg-6"><b>{{character.nature}}</b></div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6"><b>Demeanor: </b></div>
                                <div class="col-lg-6"><b>{{character.demeanor}}</b></div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6"><b>Path: </b></div>
                                <div class="col-lg-6"><b>{{character.path.name}}</b></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Attributes -->
                <div class="panel panel-default" ng-show="currentIndex > 1">
                    <div class="panel-heading">
                        Attributes
                    </div>
                    <div class="panel-body">
                        <div class="col-lg-4">
                            <ul class="list-group">
                                <li class="list-group-item active">
                                    {{calctotal(character.attributes.physical)}} Physical
                                </li>
                                <li ng-repeat='t in character.attributes.physical | orderBy:"name":false'
                                    class="list-group-item trait">
                                    {{ t.name }}
                                            <span ng-show="t.val > 1">
                                                ({{ t.val }})
                                            </span>
                                </li>
                            </ul>
                        </div>
                        <div class="col-lg-4">
                            <ul class="list-group">
                                <li class="list-group-item active">
                                    {{calctotal(character.attributes.social)}} Social
                                </li>
                                <li ng-repeat='t in character.attributes.social | orderBy:"name":false'
                                    class="list-group-item trait">
                                    {{ t.name }}
                                            <span ng-show="t.val > 1">
                                                ({{ t.val }})
                                            </span>
                                </li>
                            </ul>
                        </div>
                        <div class="col-lg-4">
                            <ul class="list-group">
                                <li class="list-group-item active">
                                    {{calctotal(character.attributes.mental)}} Mental
                                </li>
                                <li ng-repeat='t in character.attributes.mental | orderBy:"name":false'
                                    class="list-group-item trait">
                                    {{ t.name }}
                                            <span ng-show="t.val > 1">
                                                ({{ t.val }})
                                            </span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Advantages -->
                <div class="panel panel-default" ng-show="currentIndex > 2">
                    <div class="panel-heading">
                        Advantages
                    </div>
                    <div class="panel-body">
                        <div class="col-lg-4">
                            <ul class="list-group">
                                <li class="list-group-item active">
                                    {{calctotal(character.abilities)}} Abilities
                                </li>
                                <li ng-repeat='t in character.abilities | orderBy:"name":false'
                                    class="list-group-item trait">
                                    {{ t.name }}
                                    <span ng-show="t.val > 1">
                                        x{{ t.val }}
                                    </span>
                                    <span ng-show="t.note.length > 0">
                                        ({{ t.note }})
                                    </span>
                                </li>
                            </ul>
                        </div>
                        <div class="col-lg-4">
                            <ul class="list-group">
                                <li class="list-group-item active">
                                    {{calctotal(character.disciplines)}} Disciplines
                                </li>
                                <li ng-repeat='t in character.disciplines | orderBy:"path":false'
                                    class="list-group-item trait">
                                    {{t.path}}: {{ t.name }} ({{t.level}})
                                </li>
                            </ul>
                        </div>
                        <div class="col-lg-4">
                            <ul class="list-group">
                                <li class="list-group-item active">
                                    {{calctotal(character.backgrounds)}} Backgrounds
                                </li>
                                <li ng-repeat='t in character.backgrounds | orderBy:"name":false'
                                    class="list-group-item trait">
                                    {{ t.name }}
                                    <span ng-show="t.val > 1">
                                        x{{ t.val }}
                                    </span>
                                    <span ng-show="t.note.length > 0">
                                        ({{ t.note }})
                                    </span>
                                </li>
                            </ul>
                        </div>
                        <div class="col-lg-4">
                            <ul class="list-group">
                                <li class="list-group-item active">
                                    {{calctotal(character.influences)}} Influences
                                </li>
                                <li ng-repeat='t in character.influences | orderBy:"name":false'
                                    class="list-group-item trait">
                                    {{ t.name }}
                                    <span ng-show="t.val > 1">
                                        x{{ t.val }}
                                    </span>
                                    <span ng-show="t.note.length > 0">
                                        ({{ t.note }})
                                    </span>
                                </li>
                            </ul>
                        </div>
                        <div class="col-lg-4" ng-show="currentIndex > 3">
                            <ul class="list-group">
                                <li class="list-group-item active">
                                    {{character.conscience.rating + character.selfcontrol.rating + character.courage.rating}} Virtues
                                </li>
                                <li class="list-group-item trait">
                                    {{character.conscience.name}} x {{character.conscience.rating}}
                                </li>
                                <li class="list-group-item trait">
                                    {{character.selfcontrol.name}} x {{character.selfcontrol.rating}}
                                </li>
                                <li class="list-group-item trait">
                                    {{character.courage.name}} x {{character.courage.rating}}
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Disadvantages -->
                <div class="panel panel-default" ng-show="currentIndex > 3">
                    <div class="panel-heading">
                        Disadvantages
                    </div>
                    <div class="panel-body">
                        <div class="col-lg-4">
                            <ul class="list-group">
                                <li class="list-group-item active">
                                    {{calctotal(character.attributes.negativephysical)}} Negative Physical
                                </li>
                                <li ng-repeat='t in character.attributes.negativephysical | orderBy:"name":false'
                                    class="list-group-item trait">
                                    {{ t.name }}
                                    <span ng-show="t.val > 1">
                                        ({{ t.val }})
                                    </span>
                                </li>
                            </ul>
                        </div>
                        <div class="col-lg-4">
                            <ul class="list-group">
                                <li class="list-group-item active">
                                    {{calctotal(character.attributes.negativesocial)}} Negative Social
                                </li>
                                <li ng-repeat='t in character.attributes.negativesocial | orderBy:"name":false'
                                    class="list-group-item trait">
                                    {{ t.name }}
                                    <span ng-show="t.val > 1">
                                        ({{ t.val }})
                                    </span>
                                </li>
                            </ul>
                        </div>
                        <div class="col-lg-4">
                            <ul class="list-group">
                                <li class="list-group-item active">
                                    {{calctotal(character.attributes.negativemental)}} Negative Mental
                                </li>
                                <li ng-repeat='t in character.attributes.negativemental | orderBy:"name":false'
                                    class="list-group-item trait">
                                    {{ t.name }}
                                    <span ng-show="t.val > 1">
                                        ({{ t.val }})
                                    </span>
                                </li>
                            </ul>
                        </div>
                        <div class="col-lg-4">
                            <ul class="list-group">
                                <li class="list-group-item active">
                                    {{calctotalcost(character.flaws)}} Flaws
                                </li>
                                <li ng-repeat='t in character.flaws | orderBy:"name":false'
                                    class="list-group-item trait">
                                    {{ t.name }} ({{t.cost}})
                                </li>
                            </ul>
                        </div>
                        <div class="col-lg-4">
                            <ul class="list-group">
                                <li class="list-group-item active">
                                    {{calctotal(character.derangements)}}Derangements
                                </li>
                                <li ng-repeat='t in character.derangements'
                                    class="list-group-item trait">
                                    {{ t.name }}
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- add note Modal -->
    <div id="advNoteModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Edit note for {{noteItem.name}} ({{noteItem.rating}})</h4>
                </div>
                <div class="modal-body">
                    Note: <input type="text" ng-model="noteItem.note"/>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" ng-click="revertNoteItem()" data-dismiss="modal">
                        Cancel
                    </button>
                    <button type="button" class="btn btn-primary" ng-click="saveNoteItem()" data-dismiss="modal">Ok
                    </button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->
</div>